import json
from pathlib import Path
from typing import Dict, Any, List
from general_function import CredentialTransformer

# ---------- DTE Transformer ----------
class DTETransformer(CredentialTransformer):
    def transform(self) -> Dict[str, Any]:
        '''
        This function transforms data in "components" 
        '''
        # Apply general migrations first
        # self.component = GeneralMigrator.migrate_general_v_050_to_v_060(self.component)
        
        # Specific DFR data model changes for "component"
        data = self.component["props"]["data"]

        # Reference Implementation Updates
        # 1. Updates Schema URL to v0.6.0
        schema = self.component["props"]["schema"]
        schema_url_0_6_0 = {
            "TransactionEvent": "https://jargon.sh/user/unece/traceabilityEvents/v/0.6.0/artefacts/jsonSchemas/TransactionEvent.json?class=TransactionEvent",
            "ObjectEvent": "https://jargon.sh/user/unece/traceabilityEvents/v/0.6.0/artefacts/jsonSchemas/ObjectEvent.json?class=ObjectEvent",
            "AssociationEvent": "https://jargon.sh/user/unece/traceabilityEvents/v/0.6.0/artefacts/jsonSchemas/AssociationEvent.json?class=AssociationEvent",
            "AggregationEvent": "https://jargon.sh/user/unece/traceabilityEvents/v/0.6.0/artefacts/jsonSchemas/AggregationEvent.json?class=AggregationEvent",
            "TransformationEvent": "https://jargon.sh/user/unece/traceabilityEvents/v/0.6.0/artefacts/jsonSchemas/TransformationEvent.json?class=TransformationEvent"
        }
        event_type = next(
            (etype for etype in schema_url_0_6_0 if etype in schema["url"]),
            None
        )
        schema["url"] = schema_url_0_6_0[event_type]
        print('event type:', event_type)

        # 3. Form Data Structure Updates (Transaction Event)
        if "type" in data:
            type = data.get("type", [])
            if "TransactionEvent" in type:
                clean_data = self._pop_and_replace_key(data, "sourcePartyId", "sourceParty")
                clean_data = self._pop_and_replace_key(clean_data, "destinationPartyId", "destinationParty")
            
                self.component["props"]["data"] = clean_data

        # Flatten credentialSubject and clean top-level data
        component_data = self.component["props"]["data"]
        self._clean_identifier_list(component_data, ['@context', 'issuer'])

        # JSON-LD issue: if event_type = 'TransformationEvent', then remove destinationparty and sourceparty if they are present
        if event_type == 'TransformationEvent':
            print('inside json ld issue')
            for key in list(data.keys()):
                if key.lower() in ['destinationparty', 'destinationpartyid']:
                    data.pop(key)
                if key.lower() in ['sourceparty', 'sourcepartyid']:
                    data.pop(key)

        return self.component
    
    
    def transform_services(self) -> Dict[str, Any]:
        '''
        Transforms the 'Services' section of the features.

        This function updates services for credential migration:
        - Sets the context for digitalFacilityRecord to the new vocabulary URL.
        - Updates the renderTemplate for each service with a new HTML template.
        - Cleans up type fields in renderTemplate items.
        - Renames 'otherIdentifier' to 'issuerAlsoKnownAs' in vckit issuer if present.

        Returns:
            Dict[str, Any]: The updated dictionary.
        '''
        # 2. Context in Services updates
        parameters = self.component.get('parameters', [])
        for param in parameters: #iterate through services
            context_configuration = param.get('traceabilityEvent')
            if context_configuration:
                context_configuration['context'] = ["https://test.uncefact.org/vocabulary/untp/dte/0.6.0/"]

            # 4. Render Template Updates
            hbs_template = "<!DOCTYPE html><html lang=\"en\"> <head> <meta charset=\"UTF-8\" /> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /> <link href=\"https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap\" rel=\"stylesheet\" /> <title>Digital Facility Record</title> <style> :root { /* Brand Colors */ --color-primary: rgba(35, 46, 61, 1); /* Headers, titles; Default: rgba(35, 46, 61, 1) */ --color-secondary: rgba(31, 90, 149, 1); /* Evidence titles; Default: rgba(31, 90, 149, 1) */ /* Neutrals */ --color-white: rgba(255, 255, 255, 1); /* Text, backgrounds; Default: rgba(255, 255, 255, 1) */ --color-black: rgba(0, 0, 0, 1); /* Text; Default: rgba(0, 0, 0, 1) */ --color-gray-700: rgba(35, 46, 61, 1); /* Text, matches primary; Default: rgba(35, 46, 61, 1) */ --color-gray-600: rgba(85, 96, 110, 1); /* Backgrounds, text; Default: rgba(85, 96, 110, 1) */ --color-gray-500: rgba(169, 177, 183, 1); /* Borders; Default: rgba(169, 177, 183, 1) */ --color-gray-400: rgba(212, 214, 216, 1); /* Borders; Default: rgba(212, 214, 216, 1) */ --color-gray-300: rgba(237, 239, 240, 1); /* Backgrounds, text; Default: rgba(237, 239, 240, 1) */ /* Semantic (Functional) Colors */ --color-success-bg: rgba(184, 236, 182, 1); /* Success badge background; Default: rgba(184, 236, 182, 1) */ --color-success-text: rgba(8, 50, 0, 1); /* Success badge text; Default: rgba(8, 50, 0, 1) */ --color-error-bg: rgba(255, 188, 183, 1); /* Error badge background; Default: rgba(255, 188, 183, 1) */ --color-error-text: rgba(50, 0, 0, 1); /* Error badge text; Default: rgba(50, 0, 0, 1) */ --color-link-underline-dark: rgba(79, 149, 221, 1); /* Link underlines; Default: rgba(79, 149, 221, 1) */ --color-link-underline-light: rgba(148, 196, 245, 1); /* Link underlines; Default: rgba(148, 196, 245, 1) */ --color-icon: #1f5a95; /* SVG fill, stroke; Default: #1F5A95 */ /* Font Variables */ --font-family: 'Lato', sans-serif; /* All text; Default: Lato font */ /* Font Weight Variables */ --font-weight-regular: 400; /* Standard text; Default: 400 */ --font-weight-medium: 500; /* Titles, emphasized text; Default: 500 */ --font-weight-semi-bold: 600; /* Badges; Default: 600 */ --font-weight-bold: 700; /* Headings; Default: 700 */ --font-weight-black: 900; /* Main titles; Default: 900 */ } /* Globals CSS */ * { margin: 0; box-sizing: border-box; } body { font-family: var(--font-family); } section { padding: 0 16px 0 16px; } a { text-decoration: none; } .facility-record { width: 100%; margin: 0 auto; display: flex; flex-direction: column; gap: 32px; } .facility-record-header { display: flex; flex-direction: column; width: 100%; align-items: center; } .facility-header { display: flex; flex-direction: column; width: 100%; align-items: flex-start; gap: 12px; padding: 32px 16px 20px 16px; background-color: var(--color-primary); } .facility-record .facility-title { width: 100%; font-weight: var(--font-weight-medium); color: var(--color-white); font-size: 16px; line-height: 22px; text-transform: uppercase; } .facility-record .name-description { display: flex; flex-direction: column; gap: 8px; } .facility-record .name-description h1 { font-weight: var(--font-weight-black); color: var(--color-white); font-size: 30px; line-height: 32.5px; } .facility-record .name-description p { font-weight: var(--font-weight-medium); color: var(--color-white); font-size: 16px; line-height: 17.4px; } .facility-record .facility-details-section { padding: 0px 16px 16px; align-self: stretch; width: 100%; display: flex; flex-direction: column; align-items: flex-start; gap: 4px; background-color: var(--color-gray-600); } .facility-record .grid-row { display: grid; grid-template-columns: 1fr 2fr; gap: 16px; padding: 10px 0px 12px; width: 100%; border-bottom-width: 1px; border-bottom-style: solid; } .facility-record .grid-row:last-child { border-bottom: none; } .facility-record .declarations { display: flex; flex-direction: column; gap: 12px; padding: 0px 16px; width: 100%; } .facility-record .declaration-title { font-size: 20px; font-weight: var(--font-weight-bold); line-height: 21.8px; color: var(--color-gray-700); } .facility-record .conformities-list { display: flex; flex-direction: column; gap: 8px; } .facility-record .conformity-card { display: flex; flex-direction: column; align-items: flex-start; gap: 8px; min-width: 336px; padding: 16px 18px 16px 16px; position: relative; background-color: var(--color-white); border-radius: 4px; border: 1px solid; border-color: var(--color-gray-400); } .facility-record .conformance-header { display: flex; align-items: center; justify-content: space-between; position: relative; align-self: stretch; width: 100%; flex: 0 0 auto; } .facility-record .conformance-status { display: inline-flex; align-items: center; gap: 4px; position: relative; flex: 0 0 auto; } .facility-record .conformance-label { position: relative; width: fit-content; font-weight: var(--font-weight-regular); color: var(--color-gray-600); font-size: 14px; line-height: 19.2px; } .facility-record .tags-VC-badge-red { display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 4px 8px; flex: 0 0 auto; background-color: var(--color-error-bg); color: var(--color-error-text); border-radius: 8px; overflow: hidden; } .facility-record .tags-VC-badge-green { display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 4px 8px; flex: 0 0 auto; background-color: var(--color-success-bg); color: var(--color-success-text); border-radius: 8px; overflow: hidden; } .facility-record .verifiable { width: fit-content; font-weight: var(--font-weight-semi-bold); font-size: 14px; line-height: 15.3px; } .facility-record .evidence-details { display: flex; flex-direction: column; align-items: center; gap: 4px; position: relative; align-self: stretch; width: 100%; flex: 0 0 auto; } .facility-record .facility-name { position: relative; align-self: stretch; margin-top: -1px; font-weight: var(--font-weight-regular); color: var(--color-secondary); font-size: 18px; line-height: 21.2px; } .facility-record .regulation-details { color: var(--color-gray-600); font-size: 14px; line-height: 19.2px; align-self: stretch; font-weight: var(--font-weight-regular); } .facility-record .regulation-details-text { font-weight: var(--font-weight-regular); font-size: 14px; line-height: 19.2px; } .facility-record .regulation-link { color: var(--color-gray-600); } .facility-record .gray-bottom-line { border-bottom: 1px var(--color-gray-600) solid; width: fit-content; text-decoration: none; } .facility-record .metrics-list { display: flex; flex-direction: column; align-items: flex-start; justify-content: flex-end; gap: 8px; align-self: stretch; width: 100%; } .facility-record .metric-item { display: flex; flex-direction: column; align-items: flex-start; gap: 8px; flex: 1; flex-grow: 1; } .facility-record .typography-heading { display: inline-flex; align-items: center; justify-content: center; gap: 10px; } .facility-record .metric-value { flex: 1; color: var(--color-gray-700); font-size: 16px; font-weight: var(--font-weight-regular); line-height: 17.44px; } .facility-record .metric-score { flex: 1; font-weight: var(--font-weight-regular); color: var(--color-gray-600); font-size: 14px; line-height: 19.2px; } .facility-record .evidence-link-container { display: flex; align-items: center; justify-content: space-between; padding: 8px 0px; position: relative; align-self: stretch; width: 100%; flex: 0 0 auto; border-radius: 4px; } .facility-record .evidence-link { display: inline-flex; align-items: center; gap: 8px; position: relative; flex: 0 0 auto; } .facility-record .evidence-label-wrapper { display: flex; flex-direction: column; width: 260px; align-items: flex-start; gap: 4px; } .facility-record .evidence-text { color: var(--color-black); font-size: 16px; line-height: 17.4px; align-self: stretch; font-weight: var(--font-weight-regular); } .facility-record .issuing-details { width: 100%; padding: 24px 16px 36px; background-color: var(--color-gray-300); display: flex; flex-direction: column; align-items: flex-start; gap: 4px; } .facility-record .typography-heading { display: inline-flex; align-items: center; justify-content: center; gap: 10px; } .facility-record .issuing-title { width: fit-content; font-weight: var(--font-weight-bold); color: var(--color-black); font-size: 20px; line-height: 21.8px; } .facility-record .facility-details { display: inline-flex; flex-direction: column; align-items: flex-start; width: 100%; } .facility-record .grid-row-alt { display: grid; grid-template-columns: 1.4fr 3fr; gap: 16px; padding: 10px 0px 12px; width: 100%; border-bottom-width: 1px; border-bottom-style: solid; } .facility-record .border-bottom-gray-400 { border-color: var(--color-gray-400); } .facility-record .border-bottom-gray-500 { border-color: var(--color-gray-500); } .facility-record .label { font-weight: var(--font-weight-regular); color: var(--color-gray-300); font-size: 16px; line-height: 22px; } .facility-record .label-alt { font-weight: var(--font-weight-regular); color: var(--color-gray-600); font-size: 16px; line-height: 22px; } .facility-record .grid-value-link { flex-direction: column; align-items: flex-start; gap: 6px; align-self: stretch; display: flex; flex: 1; flex-grow: 1; } .facility-record .div-wrapper { gap: 10px; display: inline-flex; align-items: flex-start; text-decoration: underline; text-decoration-thickness: 2px; text-decoration-color: var(--color-link-underline-dark); text-underline-offset: 3px; } .facility-record .map-link { display: inline-flex; align-items: flex-start; gap: 10px; border-bottom-width: 2px; border-bottom-style: solid; border-color: var(--color-link-underline-light); } .facility-record .map-link-text { width: fit-content; font-weight: var(--font-weight-medium); color: var(--color-white); font-size: 16px; line-height: 17.4px; } .facility-record .issuer<!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\" /> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /> <link href=\"https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap\" rel=\"stylesheet\" /> <style> :root { /* Brand Colors */ --color-primary: rgba(31, 90, 149, 1); /* Color for process-type text & event-indicator borders; Default: rgba(31, 90, 149, 1) */ --color-secondary: rgba(181, 213, 245, 0.5); /* Background color for event indicators; Default: rgba(181, 213, 245, 0.5) */ /* Neutrals */ --color-white: rgba(255, 255, 255, 1); /* Background for cards, item-list containers & issuing details section; Default: rgba(255, 255, 255, 1) */ --color-black: rgba(0, 0, 0, 1); /* Text color for section headings, labels, event-time & body text; Default: rgba(0, 0, 0, 1) */ --color-gray-700: rgba(35, 46, 61, 1); /* Text color for link text, section titles, view-link & sensor names; Default: rgba(35, 46, 61, 1) */ --color-gray-600: rgba(85, 96, 110, 1); /* Text color for sensor labels, item IDs & location links; Default: rgba(85, 96, 110, 1) */ --color-gray-400: rgba(212, 214, 216, 1); /* Border color for data rows, cards & containers; Default: rgba(212, 214, 216, 1) */ --color-gray-300: rgba(237, 239, 240, 1); /* Background for issuing-details section wrapper; Default: rgba(237, 239, 240, 1) */ --color-gray-100: rgba(250, 250, 250, 1); /* Background for main traceability container; Default: rgba(250, 250, 250, 1) */ /* Semantic (Functional) Colors */ --color-link-underline: rgba(79, 149, 221, 1); /* Underline color for links; Default: rgba(79, 149, 221, 1) */ --color-icon: rgba(31, 90, 149, 1); /* Fill color for all SVG icons; Default: rgba(31, 90, 149, 1) */ /* Font Variables */ --font-family: 'Lato', sans-serif; /* Font family for body text & headings; Default: 'Lato', sans-serif */ /* Font Weight Variables */ --font-weight-light: 300; /* Light weight for fine-detail text (unused); Default: 300 */ --font-weight-regular: 400; /* Regular weight for labels, data rows & body text; Default: 400 */ --font-weight-medium: 500; /* Medium weight for link text & emphasis; Default: 500 */ --font-weight-semi-bold: 600; /* Semi-bold weight for subheadings & indicator text; Default: 600 */ --font-weight-bold: 700; /* Bold weight for section headings; Default: 700 */ --font-weight-black: 900; /* Black weight for process-type and primary headers; Default: 900 */ } /* Global Styles */ * { margin: 0; box-sizing: border-box; } body { font-family: var(--font-family); } a { text-decoration: none; } /* Main Container Styles */ .traceability-container { margin: 0 auto; display: flex; flex-direction: column; gap: 32px; word-break: break-word; background-color: var(--color-gray-100); } .traceability-content { display: flex; flex-direction: column; width: 100%; align-items: center; gap: 12px; } .header-section { display: flex; flex-direction: column; width: 100%; align-items: flex-start; gap: 12px; padding: 16px 0 0 16px; } .credential-title { width: 100%; font-weight: var(--font-weight-medium); color: var(--color-gray-700); font-size: 16px; line-height: 22px; text-transform: uppercase; } .data-section { display: inline-flex; flex-direction: column; align-items: flex-start; width: 100%; } .data-row-standard { display: grid; grid-template-columns: 1.4fr 3fr; gap: 16px; padding: 10px 0px 12px; width: 100%; border-bottom-width: 1px; border-bottom-style: solid; } .data-row-compact { display: grid; grid-template-columns: 1.2fr 2fr; gap: 16px; padding: 10px 0px 12px; width: 100%; border-bottom-width: 1px; border-bottom-style: solid; } .data-label { font-weight: var(--font-weight-regular); color: var(--color-gray-700); font-size: 16px; line-height: 17.4px; } .data-value-container { display: flex; align-items: center; justify-content: center; gap: 10px; align-self: stretch; flex-grow: 1; flex: 1; } .data-value { flex: 1; font-weight: var(--font-weight-medium); color: var(--color-gray-700); font-size: 16px; line-height: 17.4px; } .data-link-container { flex-direction: column; align-items: flex-start; gap: 6px; align-self: stretch; display: flex; flex: 1; flex-grow: 1; } .link-highlight { display: inline-flex; align-items: flex-start; gap: 10px; border-bottom-width: 2px; border-bottom-style: solid; border-color: var(--color-link-underline); } .link-text { width: fit-content; font-weight: var(--font-weight-medium); color: var(--color-gray-700); font-size: 16px; line-height: 17.4px; } .main-content { display: flex; flex-direction: column; align-items: center; gap: 32px; padding: 0px 16px; align-self: stretch; width: 100%; } .section-heading { width: fit-content; font-weight: var(--font-weight-bold); color: var(--color-black); font-size: 20px; line-height: 21.8px; } .navigation-link { display: inline-flex; align-items: center; gap: 10px; } .view-link { font-size: 16px; font-weight: var(--font-weight-medium); line-height: 17.44px; color: var(--color-gray-700); } .sensor-info-section { display: flex; flex-direction: column; width: 100%; align-items: flex-start; gap: 16px; } .heading-group { display: inline-flex; align-items: center; justify-content: center; gap: 10px; } .sensor-card { display: flex; flex-direction: column; align-items: flex-start; gap: 16px; padding: 16px; align-self: stretch; width: 100%; background-color: var(--color-white); border-radius: 4px; border: 1px solid; border-color: var(--color-gray-400); } .sensor-details { display: inline-flex; flex-direction: column; align-items: flex-start; gap: 4px; width: 100%; } .sensor-name { font-weight: var(--font-weight-medium); color: var(--color-gray-700); font-size: 16px; line-height: 18.8px; } .sensor-link { display: inline-flex; align-items: flex-start; text-decoration: underline; text-decoration-thickness: 2px; text-decoration-color: var(--color-link-underline); text-underline-offset: 3px; } .sensor-link-text { width: fit-content; font-weight: var(--font-weight-medium); color: var(--color-gray-700); font-size: 14px; line-height: 15.3px; } .sensor-data-group { display: flex; flex-direction: column; align-items: flex-start; gap: 4px; align-self: stretch; width: 100%; } .sensor-label { font-weight: var(--font-weight-regular); color: var(--color-gray-600); font-size: 16px; line-height: 17.4px; } .sensor-value { font-weight: var(--font-weight-medium); color: var(--color-gray-700); font-size: 16px; line-height: 17.4px; flex: 1; } .data-value-wrapper { align-items: center; justify-content: center; gap: 10px; display: flex; flex: 1; flex-grow: 1; } .traceability-link { display: flex; align-items: center; justify-content: space-between; align-self: stretch; padding: 8px 0px; } .link-group { display: inline-flex; align-items: center; gap: 12px; } .organization-name-container { display: flex; flex-direction: column; align-items: flex-start; gap: 4px; } .organization-name { align-self: stretch; font-weight: var(--font-weight-regular); color: var(--color-black); font-size: 16px; line-height: 17.4px; } .issuing-details-section { width: 100%; padding: 24px 16px 36px; background-color: var(--color-gray-300); display: flex; flex-direction: column; align-items: flex-start; gap: 4px; } .issuing-title { width: fit-content; font-weight: var(--font-weight-bold); color: var(--color-black); font-size: 20px; line-height: 21.8px; } .event-header { display: flex; flex-direction: column; gap: 12px; padding-top: 3px; } .process-type { font-size: 30px; font-weight: var(--font-weight-black); line-height: 32.7px; color: var(--color-primary); } .event-time { font-size: 16px; font-weight: var(--font-weight-regular); line-height: 18.88px; color: var(--color-black); text-transform: capitalize; } .event-time span { font-size: 16px; font-weight: var(--font-weight-medium); line-height: 17.44px; color: var(--color-gray-700); } .event-details { width: 100%; display: inline-flex; flex-direction: column; align-items: flex-start; gap: 24px; } .location-link { font-size: 16px; font-weight: var(--font-weight-regular); line-height: 17.44px; color: var(--color-gray-700); } .border-gray-400 { border-color: var(--color-gray-400); } .item-list-container { display: flex; flex-direction: column; gap: 8px; width: 100%; background-color: var(--color-white); padding: 16px 18px 16px 16px; border-radius: 4px; border: 1px solid; border-color: var(--color-gray-400); } .transaction-list { display: flex; flex-direction: column; gap: 8px; width: 100%; border-color: var(--color-gray-400); } .list-title { font-size: 18px; font-weight: var(--font-weight-regular); line-height: 21.24px; color: var(--color-primary); } .item-list { display: flex; flex-direction: column; align-items: flex-start; justify-content: space-around; width: 100%; } .item-row { display: grid; grid-template-columns: 1fr auto; gap: 16px; padding: 10px 0px 12px; width: 100%; } .item-row-pair { display: grid; grid-template-columns: 1fr 2fr; gap: 16px; padding: 10px 0px 12px; width: 100%; } .item-row-bordered { border-bottom-width: 1px; border-bottom-style: solid; border-color: var(--color-gray-400); } .item-name-text { font-size: 16px; font-weight: var(--font-weight-regular); line-height: 17.44px; } .event-group { display: inline-flex; flex-direction: column; gap: 12px; width: 100%; align-items: center; } .location-container { margin-top: -8px; } /* Event Type Specific Styles */ .transformation-event, .aggregation-event, .object-event, .association-event, .transaction-event { display: none; width: 100%; } .transformation-event.TransformationEvent, .aggregation-event.AggregationEvent, .object-event.ObjectEvent, .association-event.AssociationEvent, .transaction-event.TransactionEvent { display: flex; flex-direction: column; gap: 24px; } /* Event Indicator Styles */ .transformation-event .indicator, .aggregation-event .indicator, .object-event .indicator, .association-event .indicator, .transaction-event .indicator { padding-right: 12px; background: var(--color-secondary); border-radius: 4px; overflow: hidden; border: 1px solid var(--color-primary); justify-content: center; align-items: center; gap: 8px; display: inline-flex; } .transformation-event .indicator-icon, .aggregation-event .indicator-icon, .object-event .indicator-icon, .association-event .indicator-icon, .transaction-event .indicator-icon { width: 30px; height: 30px; position: relative; border-top-left-radius: 2px; border-top-right-radius: 2px; } .transformation-event .indicator > p, .aggregation-event .indicator > p, .object-event .indicator > p, .association-event .indicator > p, .transaction-event .indicator > p { color: var(--color-primary); font-size: 16px; font-weight: var(--font-weight-semi-bold); line-height: 17.44px; word-wrap: break-word; } /* Desktop Adjustments */ @media (min-width: 1200px) { .traceability-container { max-width: 1200px; } } </style> </head> <body> <div class=\"traceability-container\"> <div class=\"traceability-content\"> <header class=\"header-section\"> <div class=\"credential-header\"> <div class=\"credential-title\">DIGITAL TRACEABILITY EVENT</div> </div> </header> <section class=\"main-content\"> {{#each credentialSubject}} <article class=\"transformation-event {{#each type}}{{.}} {{/each}}\"> <header class=\"event-header\"> <h2 class=\"process-type\">{{processType}}</h2> {{#if bizStep}} <div class=\"event-time\"> {{bizStep}} <span>{{eventTime}}</span> </div> {{/if}} </header> <section class=\"event-details\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Transformation</h3> </header> <div class=\"event-group\"> {{#if outputEPCList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Output</div> <div class=\"item-list\"> {{#each outputEPCList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{name}}</div>   <a href=\"{{id}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} {{#if outputQuantityList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Output</div> <div class=\"item-list\"> {{#each outputQuantityList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{quantity}}{{uom}} {{productName}}</div>   <a href=\"{{productId}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} <div class=\"indicator\"> <div class=\"indicator-icon\"> <svg width=\"30\" height=\"30\" viewBox=\"0 0 30 30\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">   <path 	fill-rule=\"evenodd\" 	clip-rule=\"evenodd\" 	 d=\"M30 0H0V30H30V0ZM14.1162 22.4828H15.8838L15.8838 11.511L20.7449 16.5397L22 15.2414L15 8L8 15.2414L9.25505 16.5397L14.1162 11.511L14.1162 22.4828Z\" 	fill=\"var(--color-icon)\" /> </svg> </div> <p>Transformed</p> </div> {{#if inputEPCList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Input</div> <div class=\"item-list\"> {{#each inputEPCList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{name}}</div>   <a href=\"{{id}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} {{#if inputQuantityList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Input</div> <div class=\"item-list\"> {{#each inputQuantityList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{quantity}}{{uom}} {{productName}}</div>   <a href=\"{{productId}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} </div> </section> {{#if sensorElementList.length}} <section class=\"sensor-info-section\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Event Sensor Information</h3> </header> {{#each sensorElementList}} <article class=\"sensor-card\"> <div class=\"sensor-details\"> <div class=\"sensor-name\">{{sensorMetadata.device.name}}</div> {{#if sensorMetadata.dataProcessingMethod}} <div class=\"sensor-link\"> <a href=\"{{sensorMetadata.dataProcessingMethod}}\" class=\"sensor-link-text\" target=\"_blank\">Data processing method</a> </div> {{/if}} </div> {{#each sensorReport}} <div class=\"sensor-data-group\"> {{#if time}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Captured at</div> <div class=\"data-value-container\">   <div class=\"sensor-value\">{{time}}</div> </div> </div> {{/if}} {{#if sensorType}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Sensor type</div> <div class=\"data-link-container\">   <div class=\"sensor-link\"> 	<a href=\"{{sensorType}}\" class=\"link-text\" target=\"_blank\">Type information</a>   </div> </div> </div> {{/if}} {{#if value}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Reading</div> <div class=\"data-value-wrapper\">   <div class=\"sensor-value\">{{value}}{{uom}}</div> </div> </div> {{/if}} </div> {{/each}} {{#if sensorIntegrityProof}} <a href=\"{{sensorIntegrityProof}}\" class=\"traceability-link\" target=\"_blank\"> <div class=\"link-group\"> <svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">   <path 	d=\"M2 18C1.45 18 0.979333 17.8043 0.588 17.413C0.196667 17.0217 0.000666667 16.5507 0 16V2C0 1.45 0.196 0.979333 0.588 0.588C0.98 0.196667 1.45067 0.000666667 2 0H16C16.55 0 17.021 0.196 17.413 0.588C17.805 0.98 18.0007 1.45067 18 2V16C18 16.55 17.8043 17.021 17.413 17.413C17.0217 17.805 16.5507 18.0007 16 18H2ZM2 2V16H16V2H14V9L11.5 7.5L9 9V2H2Z\" 	fill=\"var(--color-icon)\" /> </svg> <div class=\"organization-name-container\">   <div class=\"organization-name\">Integrity proof</div> </div> </div> <svg width=\"9\" height=\"16\" viewBox=\"0 0 9 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"> <path d=\"M1 1L8 8L1 15\" stroke=\"var(--color-icon)\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" /> </svg> </a> {{/if}} </article> {{/each}} </section> {{/if}} {{#if bizLocation}} <div class=\"location-container\"> <div class=\"sensor-link\"> <a href=\"{{bizLocation}}\" class=\"location-link\" target=\"_blank\">Event location information</a> </div> </div> {{/if}} </article> <article class=\"transaction-event {{#each type}}{{.}} {{/each}}\"> <header class=\"event-header\"> <h2 class=\"process-type\">{{processType}}</h2> {{#if bizStep}} <div class=\"event-time\"> {{bizStep}} <span>{{eventTime}}</span> </div> {{/if}} </header> <section class=\"event-details\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Transaction</h3> </header> <div class=\"event-group\"> <div class=\"transaction-list\"> <div class=\"item-list\"> {{#if sourceParty}} <div class=\"item-row-pair item-row-bordered\">   <div class=\"item-name-text\">Source</div>   <a href=\"{{sourceParty}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/if}} {{#if destinationParty}} <div class=\"item-row-pair item-row-bordered\">   <div class=\"item-name-text\">Destination</div>   <a href=\"{{destinationParty}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/if}} </div> </div> {{#if epcList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Object List</div> <div class=\"item-list\"> {{#each epcList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{name}}</div>   <a href=\"{{id}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} {{#if quantityList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Object List</div> <div class=\"item-list\"> {{#each quantityList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{quantity}}{{uom}} {{productName}}</div>   <a href=\"{{productId}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} </div> </section> {{#if sensorElementList.length}} <section class=\"sensor-info-section\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Event Sensor Information</h3> </header> {{#each sensorElementList}} <article class=\"sensor-card\"> <div class=\"sensor-details\"> <div class=\"sensor-name\">{{sensorMetadata.device.name}}</div> {{#if sensorMetadata.dataProcessingMethod}} <div class=\"sensor-link\"> <a href=\"{{sensorMetadata.dataProcessingMethod}}\" class=\"sensor-link-text\" target=\"_blank\">Data processing method</a> </div> {{/if}} </div> {{#each sensorReport}} <div class=\"sensor-data-group\"> {{#if time}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Captured at</div> <div class=\"data-value-container\">   <div class=\"sensor-value\">{{time}}</div> </div> </div> {{/if}} {{#if sensorType}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Sensor type</div> <div class=\"data-link-container\">   <div class=\"sensor-link\"> 	<a href=\"{{sensorType}}\" class=\"link-text\" target=\"_blank\">Type information</a>   </div> </div> </div> {{/if}} {{#if value}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Reading</div> <div class=\"data-value-wrapper\">   <div class=\"sensor-value\">{{value}}{{uom}}</div> </div> </div> {{/if}} </div> {{/each}} {{#if sensorIntegrityProof}} <a href=\"{{sensorIntegrityProof}}\" class=\"traceability-link\" target=\"_blank\"> <div class=\"link-group\"> <svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">   <path 	d=\"M2 18C1.45 18 0.979333 17.8043 0.588 17.413C0.196667 17.0217 0.000666667 16.5507 0 16V2C0 1.45 0.196 0.979333 0.588 0.588C0.98 0.196667 1.45067 0.000666667 2 0H16C16.55 0 17.021 0.196 17.413 0.588C17.805 0.98 18.0007 1.45067 18 2V16C18 16.55 17.8043 17.021 17.413 17.413C17.0217 17.805 16.5507 18.0007 16 18H2ZM2 2V16H16V2H14V9L11.5 7.5L9 9V2H2Z\" 	fill=\"var(--color-icon)\" /> </svg> <div class=\"organization-name-container\">   <div class=\"organization-name\">Integrity proof</div> </div> </div> <svg width=\"9\" height=\"16\" viewBox=\"0 0 9 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"> <path d=\"M1 1L8 8L1 15\" stroke=\"var(--color-icon)\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" /> </svg> </a> {{/if}} </article> {{/each}} </section> {{/if}} {{#if bizLocation}} <div class=\"location-container\"> <div class=\"sensor-link\"> <a href=\"{{bizLocation}}\" class=\"location-link\" target=\"_blank\">Event location information</a> </div> </div> {{/if}} </article> <article class=\"object-event {{#each type}}{{.}} {{/each}}\"> <header class=\"event-header\"> <h2 class=\"process-type\">{{processType}}</h2> {{#if bizStep}} <div class=\"event-time\"> {{bizStep}} <span>{{eventTime}}</span> </div> {{/if}} </header> <section class=\"event-details\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Object Event</h3> </header> <div class=\"event-group\"> {{#if epcList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Object List</div> <div class=\"item-list\"> {{#each epcList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{name}}</div>   <a href=\"{{id}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} {{#if quantityList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Object List</div> <div class=\"item-list\"> {{#each quantityList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{quantity}}{{uom}} {{productName}}</div>   <a href=\"{{productId}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} </div> </section> {{#if sensorElementList.length}} <section class=\"sensor-info-section\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Event Sensor Information</h3> </header> {{#each sensorElementList}} <article class=\"sensor-card\"> <div class=\"sensor-details\"> <div class=\"sensor-name\">{{sensorMetadata.device.name}}</div> {{#if sensorMetadata.dataProcessingMethod}} <div class=\"sensor-link\"> <a href=\"{{sensorMetadata.dataProcessingMethod}}\" class=\"sensor-link-text\" target=\"_blank\">Data processing method</a> </div> {{/if}} </div> {{#each sensorReport}} <div class=\"sensor-data-group\"> {{#if time}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Captured at</div> <div class=\"data-value-container\">   <div class=\"sensor-value\">{{time}}</div> </div> </div> {{/if}} {{#if sensorType}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Sensor type</div> <div class=\"data-link-container\">   <div class=\"sensor-link\"> 	<a href=\"{{sensorType}}\" class=\"link-text\" target=\"_blank\">Type information</a>   </div> </div> </div> {{/if}} {{#if value}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Reading</div> <div class=\"data-value-wrapper\">   <div class=\"sensor-value\">{{value}}{{uom}}</div> </div> </div> {{/if}} </div> {{/each}} {{#if sensorIntegrityProof}} <a href=\"{{sensorIntegrityProof}}\" class=\"traceability-link\" target=\"_blank\"> <div class=\"link-group\"> <svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">   <path 	d=\"M2 18C1.45 18 0.979333 17.8043 0.588 17.413C0.196667 17.0217 0.000666667 16.5507 0 16V2C0 1.45 0.196 0.979333 0.588 0.588C0.98 0.196667 1.45067 0.000666667 2 0H16C16.55 0 17.021 0.196 17.413 0.588C17.805 0.98 18.0007 1.45067 18 2V16C18 16.55 17.8043 17.021 17.413 17.413C17.0217 17.805 16.5507 18.0007 16 18H2ZM2 2V16H16V2H14V9L11.5 7.5L9 9V2H2Z\" 	fill=\"var(--color-icon)\" /> </svg> <div class=\"organization-name-container\">   <div class=\"organization-name\">Integrity proof</div> </div> </div> <svg width=\"9\" height=\"16\" viewBox=\"0 0 9 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"> <path d=\"M1 1L8 8L1 15\" stroke=\"var(--color-icon)\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" /> </svg> </a> {{/if}} </article> {{/each}} </section> {{/if}} {{#if bizLocation}} <div class=\"location-container\"> <div class=\"sensor-link\"> <a href=\"{{bizLocation}}\" class=\"location-link\" target=\"_blank\">Event location information</a> </div> </div> {{/if}} </article> <article class=\"aggregation-event {{#each type}}{{.}} {{/each}}\"> <header class=\"event-header\"> <h2 class=\"process-type\">{{processType}}</h2> {{#if bizStep}} <div class=\"event-time\"> {{bizStep}} <span>{{eventTime}}</span> </div> {{/if}} </header> <section class=\"event-details\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Aggregation</h3> </header> <div class=\"event-group\"> {{#if parentEPC}} <div class=\"item-list-container\"> <div class=\"list-title\">Parent</div> <div class=\"item-list\"> <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{parentEPC.name}}</div>   <a href=\"{{parentEPC.id}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> </div> </div> {{/if}} <div class=\"indicator\"> <div class=\"indicator-icon\"> <svg width=\"30\" height=\"30\" viewBox=\"0 0 30 30\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">   <path 	 fill-rule=\"evenodd\" 	 clip-rule=\"evenodd\" 	d=\"M30 0H0V30H30V0ZM14.1162 22.4828H15.8838L15.8838 11.511L20.7449 16.5397L22 15.2414L15 8L8 15.2414L9.25505 16.5397L14.1162 11.511L14.1162 22.4828Z\" 	fill=\"var(--color-icon)\" /> </svg> </div> <p>Aggregated</p> </div> {{#if childEPCList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Child List</div> <div class=\"item-list\"> {{#each childEPCList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{name}}</div>   <a href=\"{{id}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} {{#if childQuantityList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Child List</div> <div class=\"item-list\"> {{#each childQuantityList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{quantity}}{{uom}} {{productName}}</div>   <a href=\"{{productId}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} </div> </section> {{#if sensorElementList.length}} <section class=\"sensor-info-section\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Event Sensor Information</h3> </header> {{#each sensorElementList}} <article class=\"sensor-card\"> <div class=\"sensor-details\"> <div class=\"sensor-name\">{{sensorMetadata.device.name}}</div> {{#if sensorMetadata.dataProcessingMethod}} <div class=\"sensor-link\"> <a href=\"{{sensorMetadata.dataProcessingMethod}}\" class=\"sensor-link-text\" target=\"_blank\">Data processing method</a> </div> {{/if}} </div> {{#each sensorReport}} <div class=\"sensor-data-group\"> {{#if time}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Captured at</div> <div class=\"data-value-container\">   <div class=\"sensor-value\">{{time}}</div> </div> </div> {{/if}} {{#if sensorType}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Sensor type</div> <div class=\"data-link-container\">   <div class=\"sensor-link\"> 	<a href=\"{{sensorType}}\" class=\"link-text\" target=\"_blank\">Type information</a>   </div> </div> </div> {{/if}} {{#if value}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Reading</div> <div class=\"data-value-wrapper\">   <div class=\"sensor-value\">{{value}}{{uom}}</div> </div> </div> {{/if}} </div> {{/each}} {{#if sensorIntegrityProof}} <a href=\"{{sensorIntegrityProof}}\" class=\"traceability-link\" target=\"_blank\"> <div class=\"link-group\"> <svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">   <path 	d=\"M2 18C1.45 18 0.979333 17.8043 0.588 17.413C0.196667 17.0217 0.000666667 16.5507 0 16V2C0 1.45 0.196 0.979333 0.588 0.588C0.98 0.196667 1.45067 0.000666667 2 0H16C16.55 0 17.021 0.196 17.413 0.588C17.805 0.98 18.0007 1.45067 18 2V16C18 16.55 17.8043 17.021 17.413 17.413C17.0217 17.805 16.5507 18.0007 16 18H2ZM2 2V16H16V2H14V9L11.5 7.5L9 9V2H2Z\" 	fill=\"var(--color-icon)\" /> </svg> <div class=\"organization-name-container\">   <div class=\"organization-name\">Integrity proof</div> </div> </div> <svg width=\"9\" height=\"16\" viewBox=\"0 0 9 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"> <path d=\"M1 1L8 8L1 15\" stroke=\"var(--color-icon)\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" /> </svg> </a> {{/if}} </article> {{/each}} </section> {{/if}} {{#if bizLocation}} <div class=\"location-container\"> <div class=\"sensor-link\"> <a href=\"{{bizLocation}}\" class=\"location-link\" target=\"_blank\">Event location information</a> </div> </div> {{/if}} </article> <article class=\"association-event {{#each type}}{{.}} {{/each}}\"> <header class=\"event-header\"> <h2 class=\"process-type\">{{processType}}</h2> {{#if bizStep}} <div class=\"event-time\"> {{bizStep}} <span>{{eventTime}}</span> </div> {{/if}} </header> <section class=\"event-details\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Association</h3> </header> <div class=\"event-group\"> {{#if parentEPC}} <div class=\"item-list-container\"> <div class=\"list-title\">Parent</div> <div class=\"item-list\"> <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{parentEPC.name}}</div>   <a href=\"{{parentEPC.id}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> </div> </div> {{/if}} <div class=\"indicator\"> <div class=\"indicator-icon\"> <svg width=\"30\" height=\"30\" viewBox=\"0 0 30 30\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">   <path 	fill-rule=\"evenodd\" 	clip-rule=\"evenodd\" 	d=\"M30 0H0V30H30V0ZM14.1162 22.4828H15.8838L15.8838 11.511L20.7449 16.5397L22 15.2414L15 8L8 15.2414L9.25505 16.5397L14.1162 11.511L14.1162 22.4828Z\" 	fill=\"var(--color-icon)\" /> </svg> </div> <p>Assembled</p> </div> {{#if childEPCList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Child List</div> <div class=\"item-list\"> {{#each childEPCList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{name}}</div>   <a href=\"{{id}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} {{#if childQuantityList.length}} <div class=\"item-list-container\"> <div class=\"list-title\">Child List</div> <div class=\"item-list\"> {{#each childQuantityList}} <div class=\"item-row item-row-bordered\">   <div class=\"item-name-text\">{{quantity}}{{uom}} {{productName}}</div>   <a href=\"{{productId}}\" class=\"navigation-link\" target=\"_blank\"> 	<div class=\"view-link link-highlight\">View</div>   </a> </div> {{/each}} </div> </div> {{/if}} </div> </section> {{#if sensorElementList.length}} <section class=\"sensor-info-section\"> <header class=\"heading-group\"> <h3 class=\"section-heading\">Event Sensor Information</h3> </header> {{#each sensorElementList}} <article class=\"sensor-card\"> <div class=\"sensor-details\"> <div class=\"sensor-name\">{{sensorMetadata.device.name}}</div> {{#if sensorMetadata.dataProcessingMethod}} <div class=\"sensor-link\"> <a href=\"{{sensorMetadata.dataProcessingMethod}}\" class=\"sensor-link-text\" target=\"_blank\">Data processing method</a> </div> {{/if}} </div> {{#each sensorReport}} <div class=\"sensor-data-group\"> {{#if time}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Captured at</div> <div class=\"data-value-container\">   <div class=\"sensor-value\">{{time}}</div> </div> </div> {{/if}} {{#if sensorType}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Sensor type</div> <div class=\"data-link-container\">   <div class=\"sensor-link\"> 	<a href=\"{{sensorType}}\" class=\"link-text\" target=\"_blank\">Type information</a>   </div> </div> </div> {{/if}} {{#if value}} <div class=\"data-row-compact border-gray-400\"> <div class=\"sensor-label\">Reading</div> <div class=\"data-value-wrapper\">   <div class=\"sensor-value\">{{value}}{{uom}}</div> </div> </div> {{/if}} </div> {{/each}} {{#if sensorIntegrityProof}} <a href=\"{{sensorIntegrityProof}}\" class=\"traceability-link\" target=\"_blank\"> <div class=\"link-group\"> <svg width=\"18\" height=\"18\" viewBox=\"0 0 18 18\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">   <path 	d=\"M2 18C1.45 18 0.979333 17.8043 0.588 17.413C0.196667 17.0217 0.000666667 16.5507 0 16V2C0 1.45 0.196 0.979333 0.588 0.588C0.98 0.196667 1.45067 0.000666667 2 0H16C16.55 0 17.021 0.196 17.413 0.588C17.805 0.98 18.0007 1.45067 18 2V16C18 16.55 17.8043 17.021 17.413 17.413C17.0217 17.805 16.5507 18.0007 16 18H2ZM2 2V16H16V2H14V9L11.5 7.5L9 9V2H2Z\" 	fill=\"var(--color-icon)\" /> </svg> <div class=\"organization-name-container\">   <div class=\"organization-name\">Integrity proof</div> </div> </div> <svg width=\"9\" height=\"16\" viewBox=\"0 0 9 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"> <path d=\"M1 1L8 8L1 15\" stroke=\"var(--color-icon)\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" /> </svg> </a> {{/if}} </article> {{/each}} </section> {{/if}} {{#if bizLocation}} <div class=\"location-container\"> <div class=\"sensor-link\"> <a href=\"{{bizLocation}}\" class=\"location-link\" target=\"_blank\">Event location information</a> </div> </div> {{/if}} </article> {{/each}} </section> </div> <section class=\"issuing-details-section\"> <header class=\"heading-group\"> <h2 class=\"issuing-title\">Issuing Details</h2> </header> <div class=\"data-section\"> <div class=\"data-row-standard border-gray-400\"> <div class=\"data-label\">Issued by</div> <div class=\"data-link-container\"> <div class=\"sensor-link\"> <a href=\"{{issuer.id}}\" class=\"link-text\" target=\"_blank\">{{issuer.name}}</a> </div> </div> </div> {{#if validFrom}} <div class=\"data-row-standard border-gray-400\"> <div class=\"data-label\">Valid from</div> <div class=\"data-value-container\"> <div class=\"data-value\">{{validFrom}}</div> </div> </div> {{/if}} </div> </section> </div> </body> </html>"
            render_template = context_configuration.get('renderTemplate',[])
            for item in render_template: #iterates through renderTemplate
                item["template"] = hbs_template

                # Removes duplicated type fields in renderTemplate
                if "@type" in item and "type" in item: # if both are present, delete "@type"
                    del item["@type"]
                elif "@type" in item and "type" not in item: # if only "@type" is present, change the field name to "type"
                    item["type"] = item.pop("@type")
            

            vckit = param.get('vckit')
            if vckit:
                vckit_issuer = vckit.get('issuer', {})
                if "otherIdentifier" in vckit_issuer: # Updates 'otherIdentifier' to 'issuerAlsoKnownAs' and retains the position
                    self._pop_and_replace_key(vckit_issuer, "otherIdentifier", "issuerAlsoKnownAs")

        return self.component

    def _pop_and_replace_key(self, d: Dict[str, Any], old_key: str, new_key: str):
        """
        Works like dict.pop(), but renames the key in-place
        while keeping its original position in the dict. For example:
        pop_and_replace_key(
            facility_new,         # d  the dict to modify
            "otherIdentifier",    # old_key  the key we want to change
            "facilityAlsoKnownAs" # new_key  the new name for the key
        )
        Before:

        {
            "otherIdentifier": [...],
            "address": {...},
            "locationInformation": {...}
        }
        After:

        {
            "facilityAlsoKnownAs": [...],
            "address": {...},
            "locationInformation": {...}
        }
        """
        if old_key not in d:
            return None
        value = d[old_key]
        new_dict = {}
        for k, v in d.items():
            if k == old_key:
                new_dict[new_key] = v
            else:
                new_dict[k] = v

        d.clear()
        d.update(new_dict)

        return value
    
    def _clean_identifier_list(self, identifier: Any, remove_fields: List[str] = None):
        """
        Removes specified fields from dictionaries within a list or from a single dictionary.

        This function is used to clean up identifier objects by removing unwanted fields
        (such as "type" and "idScheme") from each dictionary in a list, or directly from a dictionary.

        Args:
            identifier (Any): The identifier to clean, can be a list of dicts or a single dict.
            remove_fields (List[str], optional): List of field names to remove. Defaults to ["type", "idScheme"].

        Returns:
            Any: The cleaned identifier (list or dict).

        """
        if remove_fields is None:
            remove_fields = ["type", "idScheme"]
        if isinstance(identifier, list):
            for item in identifier:
                if isinstance(item, dict):
                    for field in remove_fields:
                        item.pop(field, None)
        elif isinstance(identifier, dict):
            for field in remove_fields:
                identifier.pop(field, None)
        return identifier
    
    def _flatten_credential_subject(self, data: Dict[str, Any], field_flatten: str) -> Dict[str, Any]:
        """
        Flattens a nested dictionary field into the parent dictionary.

        This function removes the specified field (`field_flatten`) from `data`,
        and merges its key-value pairs into the top-level of `data`.
        Useful for flattening structures like 'credentialSubject' so its contents
        are directly accessible in the parent dictionary.

        Args:
            data (Dict[str, Any]): The dictionary to flatten.
            field_flatten (str): The key of the nested dictionary to flatten.

        Returns:
            Dict[str, Any]: The updated, flattened dictionary.
        """

        if field_flatten in data:
            cs = data.pop(field_flatten)
            data.update(cs)
        return data